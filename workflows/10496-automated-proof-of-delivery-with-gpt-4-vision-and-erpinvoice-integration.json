{
  "id": "5cU1AGvVfWmNY8xF",
  "meta": {
    "instanceId": "dd69efaf8212c74ad206700d104739d3329588a6f3f8381a46a481f34c9cc281"
  },
  "name": "Proof-of-Delivery Automation & Dispute Handler",
  "tags": [],
  "nodes": [
    {
      "id": "5997a7ad-e534-4c00-9678-44eac343faae",
      "name": "Webhook - POD Submission1",
      "type": "n8n-nodes-base.webhook",
      "position": [
        -3408,
        2320
      ],
      "webhookId": "pod-delivery-submit",
      "parameters": {
        "path": "pod-delivery-submit",
        "options": {}
      },
      "typeVersion": 1.1
    },
    {
      "id": "1da6b444-4040-47a0-a1b6-0adfa87b5298",
      "name": "Sticky Note11",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3456,
        2064
      ],
      "parameters": {
        "color": 4,
        "width": 310,
        "height": 416,
        "content": "## üì¶ POD Workflow Entry\nCapture Delivery Proof Instantly\n\n‚Ä¢ What: Webhook grabs driver-submitted data (photos, signatures, GPS coords).\n‚Ä¢ Why: No manual uploads‚Äîensures 100% capture for audit-proof records.\n‚Ä¢ Next: Feeds into validation to flag issues early."
      },
      "typeVersion": 1
    },
    {
      "id": "7ee1f974-2743-4767-8849-1a739d8fd140",
      "name": "Validate Input Data1",
      "type": "n8n-nodes-base.if",
      "position": [
        -2976,
        2320
      ],
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.body.delivery_id }}",
              "operation": "isNotEmpty"
            },
            {
              "value1": "={{ $json.body.signature_image }}",
              "operation": "isNotEmpty"
            },
            {
              "value1": "={{ $json.body.delivery_photo }}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "typeVersion": 1
    },
    {
      "id": "a7aacd2e-416b-489f-86a6-232040a3fd8e",
      "name": "Return Error1",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        -2720,
        2608
      ],
      "parameters": {
        "options": {
          "responseCode": 400
        },
        "respondWith": "json",
        "responseBody": "={{ {\"error\": \"Missing required fields\", \"message\": \"delivery_id, signature_image, and delivery_photo are required\"} }}"
      },
      "typeVersion": 1
    },
    {
      "id": "26655e92-8458-4fe3-b875-02def9409ea7",
      "name": "AI Photo Verification1",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -2624,
        1792
      ],
      "parameters": {
        "url": "https://api.openai.com/v1/chat/completions",
        "method": "POST",
        "options": {},
        "sendBody": true,
        "sendHeaders": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "gpt-4-vision-preview"
            },
            {
              "name": "messages",
              "value": "={{ [{\"role\": \"user\", \"content\": [{\"type\": \"text\", \"text\": \"Analyze this delivery proof photo. Check for: 1) Package visibility 2) Clear address/location 3) Proper placement 4) Any damage visible. Respond in JSON format with: {verified: boolean, confidence: number, issues: array, description: string}\"}, {\"type\": \"image_url\", \"image_url\": {\"url\": $json.body.delivery_photo}}]}] }}"
            },
            {
              "name": "max_tokens",
              "value": "500"
            }
          ]
        },
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        }
      },
      "typeVersion": 4.1
    },
    {
      "id": "e25cf0a8-298a-4f73-9290-fb49cf1a029a",
      "name": "AI Signature Verification1",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -2608,
        2320
      ],
      "parameters": {
        "url": "https://api.openai.com/v1/chat/completions",
        "method": "POST",
        "options": {},
        "sendBody": true,
        "sendHeaders": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "gpt-4-vision-preview"
            },
            {
              "name": "messages",
              "value": "={{ [{\"role\": \"user\", \"content\": [{\"type\": \"text\", \"text\": \"Analyze this signature image. Check if it appears to be: 1) A genuine handwritten signature 2) Clear and legible 3) Not a printed/typed name 4) Complete (not partial). Respond in JSON: {valid: boolean, confidence: number, concerns: array}\"}, {\"type\": \"image_url\", \"image_url\": {\"url\": $json.body.signature_image}}]}] }}"
            },
            {
              "name": "max_tokens",
              "value": "300"
            }
          ]
        },
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        }
      },
      "typeVersion": 4.1
    },
    {
      "id": "6f10644e-315f-47b5-aecb-cbb5e778e5a8",
      "name": "Merge Analysis Results1",
      "type": "n8n-nodes-base.code",
      "position": [
        -2384,
        2224
      ],
      "parameters": {
        "jsCode": "const webhookData = $input.first().json.body;\nconst photoAnalysis = JSON.parse($input.all()[1].json.choices[0].message.content);\nconst signatureAnalysis = JSON.parse($input.all()[2].json.choices[0].message.content);\n\nconst photoVerified = photoAnalysis.verified && photoAnalysis.confidence > 0.7;\nconst signatureValid = signatureAnalysis.valid && signatureAnalysis.confidence > 0.7;\n\nconst overallStatus = photoVerified && signatureValid ? 'verified' : 'disputed';\n\nreturn {\n  json: {\n    delivery_id: webhookData.delivery_id,\n    driver_id: webhookData.driver_id || 'UNKNOWN',\n    recipient_name: webhookData.recipient_name || '',\n    delivery_status: overallStatus,\n    verification: {\n      photo: {\n        verified: photoVerified,\n        confidence: photoAnalysis.confidence,\n        issues: photoAnalysis.issues || [],\n        description: photoAnalysis.description\n      },\n      signature: {\n        valid: signatureValid,\n        confidence: signatureAnalysis.confidence,\n        concerns: signatureAnalysis.concerns || []\n      }\n    },\n    gps_coordinates: webhookData.gps_coordinates || null,\n    timestamp: new Date().toISOString(),\n    images: {\n      signature: webhookData.signature_image,\n      delivery: webhookData.delivery_photo\n    }\n  }\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "75ca1a66-3826-44c1-9430-74fa19ea35fe",
      "name": "Sticky Note14",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2112,
        1920
      ],
      "parameters": {
        "color": 6,
        "width": 176,
        "height": 460,
        "content": "‚úÖ Verdict Gatekeeper\n\n‚Ä¢ What: If score >80%, route to success; else, flag for dispute.\n‚Ä¢ Why: Single decision point‚Äîavoids over-processing bad data, streamlining flow.\n‚Ä¢ Branches to: ERP update (green) or ticket creation (red)."
      },
      "typeVersion": 1
    },
    {
      "id": "7d659c6e-73ce-4dc8-b2fe-7029b21d2c04",
      "name": "Check Verification Status1",
      "type": "n8n-nodes-base.if",
      "position": [
        -2048,
        2224
      ],
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.delivery_status }}",
              "value2": "verified",
              "operation": "equals"
            }
          ]
        }
      },
      "typeVersion": 1
    },
    {
      "id": "2f96245b-7c51-426b-930d-8677f2e36b5e",
      "name": "Update Delivery Status1",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -1840,
        2016
      ],
      "parameters": {
        "url": "https://your-erp-system.com/api/deliveries/update",
        "method": "POST",
        "options": {},
        "jsonBody": "={{ {\n  \"delivery_id\": $json.delivery_id,\n  \"status\": \"delivered\",\n  \"delivered_at\": $json.timestamp,\n  \"signature_url\": $json.images.signature,\n  \"proof_photo_url\": $json.images.delivery,\n  \"gps_coordinates\": $json.gps_coordinates,\n  \"verification_confidence\": $json.verification.photo.confidence\n} }}",
        "sendBody": true,
        "specifyBody": "json"
      },
      "typeVersion": 4.1
    },
    {
      "id": "388cb0af-8b05-4b56-9aee-2410474b3b1d",
      "name": "Sticky Note15",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1920,
        1648
      ],
      "parameters": {
        "color": 3,
        "width": 300,
        "height": 540,
        "content": "üîÑ ERP Sync: Status Update\n\n‚Ä¢ What: Pushes \"Delivered\" to ERP (e.g., SAP/NetSuite) with POD refs.\n‚Ä¢ Why: Real-time inventory accuracy‚Äîtriggers warehouse restock, cuts stockouts.\n‚Ä¢ Flows from: Verified check; logs timestamp for compliance."
      },
      "typeVersion": 1
    },
    {
      "id": "24d13fb3-87ad-47d5-b58a-f7387376ccd5",
      "name": "Trigger Invoice Generation1",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -1456,
        2016
      ],
      "parameters": {
        "url": "https://your-billing-system.com/api/invoices/generate",
        "method": "POST",
        "options": {},
        "jsonBody": "={{ {\n  \"delivery_id\": $json.delivery_id,\n  \"invoice_date\": $json.timestamp,\n  \"status\": \"ready_for_billing\",\n  \"proof_of_delivery\": true,\n  \"verification_passed\": true\n} }}",
        "sendBody": true,
        "specifyBody": "json"
      },
      "typeVersion": 4.1
    },
    {
      "id": "15454b74-f2cb-43d1-8866-6d495df7c11a",
      "name": "Create Dispute Ticket1",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -1824,
        2464
      ],
      "parameters": {
        "url": "https://your-support-system.com/api/tickets/create",
        "method": "POST",
        "options": {},
        "jsonBody": "={{ {\n  \"title\": \"Delivery Verification Failed - \" + $json.delivery_id,\n  \"type\": \"dispute\",\n  \"priority\": \"high\",\n  \"delivery_id\": $json.delivery_id,\n  \"driver_id\": $json.driver_id,\n  \"description\": \"Automated POD verification failed. Issues found:\\n\\nPhoto Issues: \" + JSON.stringify($json.verification.photo.issues) + \"\\n\\nSignature Concerns: \" + JSON.stringify($json.verification.signature.concerns),\n  \"metadata\": {\n    \"photo_confidence\": $json.verification.photo.confidence,\n    \"signature_confidence\": $json.verification.signature.confidence,\n    \"signature_url\": $json.images.signature,\n    \"photo_url\": $json.images.delivery,\n    \"gps_coordinates\": $json.gps_coordinates\n  },\n  \"status\": \"open\",\n  \"assigned_to\": \"dispute_team\"\n} }}",
        "sendBody": true,
        "specifyBody": "json"
      },
      "typeVersion": 4.1
    },
    {
      "id": "210d794d-48a7-4aec-830b-a0eeedc9431c",
      "name": "Sticky Note16",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1888,
        2240
      ],
      "parameters": {
        "color": 4,
        "width": 272,
        "height": 384,
        "content": "‚ö†Ô∏è Dispute Launcher\n\n‚Ä¢ What: If verification fails, creates support ticket with issue details (e.g., damage photo).\n‚Ä¢ Why: Proactive escalation‚Äîresolves mismatches in <24h vs. manual weeks.\n‚Ä¢ Flows to: High-priority tag; notifies team via Slack/email."
      },
      "typeVersion": 1
    },
    {
      "id": "6d686a2e-57cb-494b-9401-c1c421bf4fca",
      "name": "Notify Dispute Team1",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -1424,
        2464
      ],
      "parameters": {
        "url": "https://your-notification-service.com/api/send",
        "method": "POST",
        "options": {},
        "jsonBody": "={{ {\n  \"recipient\": \"dispute-team@company.com\",\n  \"subject\": \"‚ö†Ô∏è Delivery Dispute - \" + $json.delivery_id,\n  \"body\": \"A delivery verification has failed and requires manual review.\\n\\nDelivery ID: \" + $json.delivery_id + \"\\nDriver: \" + $json.driver_id + \"\\nTimestamp: \" + $json.timestamp + \"\\n\\nReview the ticket for full details and evidence.\",\n  \"priority\": \"high\"\n} }}",
        "sendBody": true,
        "specifyBody": "json"
      },
      "typeVersion": 4.1
    },
    {
      "id": "f0cc7963-5833-49d3-a4cf-295a478981ed",
      "name": "Sticky Note17",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1504,
        2224
      ],
      "parameters": {
        "color": 5,
        "width": 220,
        "height": 412,
        "content": "üîî Team Alert\n\n‚Ä¢ What: Sends Slack/email with ticket link, priority flag, and evidence summary.\n‚Ä¢ Why: Loops in support fast‚Äîhigh-priority routing ensures quick driver follow-up.\n‚Ä¢ Flows from: Ticket creation; tracks response time."
      },
      "typeVersion": 1
    },
    {
      "id": "aae5eb3f-ad51-4ca9-8eda-0ba930fe4c7e",
      "name": "Success Response1",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        -1184,
        2144
      ],
      "parameters": {
        "options": {},
        "respondWith": "json",
        "responseBody": "={{ {\n  \"success\": true,\n  \"delivery_id\": $json.delivery_id,\n  \"status\": \"verified\",\n  \"message\": \"Delivery verified and invoice triggered\",\n  \"verification_details\": $json.verification\n} }}"
      },
      "typeVersion": 1
    },
    {
      "id": "165d79a1-17d5-4e44-8be0-a3115109373b",
      "name": "Dispute Response1",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        -1168,
        2320
      ],
      "parameters": {
        "options": {},
        "respondWith": "json",
        "responseBody": "={{ {\n  \"success\": true,\n  \"delivery_id\": $json.delivery_id,\n  \"status\": \"disputed\",\n  \"message\": \"Delivery verification failed - dispute ticket created\",\n  \"ticket_created\": true,\n  \"verification_details\": $json.verification\n} }}"
      },
      "typeVersion": 1
    },
    {
      "id": "c26c79ab-cef0-47bd-96e1-fb3069933094",
      "name": "Sticky Note18",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1248,
        1872
      ],
      "parameters": {
        "color": 4,
        "width": 220,
        "height": 652,
        "content": "üì§ Echo Back Success\n\n‚Ä¢ What: Returns JSON to caller (e.g., driver app) with status, ref ID, next steps.\n‚Ä¢ Why: Closes the loop for users‚Äîconfirms submission, reduces \"where's my POD?\" queries.\n‚Ä¢ Includes: Processing time, verification details."
      },
      "typeVersion": 1
    },
    {
      "id": "e646dfa2-f915-45a4-89e2-fada3cf651e2",
      "name": "Sticky Note19",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3504,
        1360
      ],
      "parameters": {
        "width": 672,
        "height": 624,
        "content": "## üöÄ Workflow Overview\n\nProof-of-Delivery Automation: End-to-End Logistics Magic\n\n‚Ä¢ What: Ingests POD data (signatures, photos, GPS) ‚Üí Verifies with AI ‚Üí Updates ERP/invoices ‚Üí Handles disputes.\n‚Ä¢ Why: Cuts billing errors by 80% and resolves issues in hours, not days‚Äîseamless for high-volume deliveries.\n‚Ä¢ Pro Tip: Trigger via webhook for real-time magic. Starts here ‚Üí Ends with alerts & reports.\n\nHow it works\n\nThis Proof-of-Delivery (POD) Automation handles delivery confirmations end-to-end. It validates incoming webhook data, verifies proof images and signatures using AI, consolidates results, and determines whether the delivery is verified or disputed. Verified deliveries trigger ERP updates and auto-invoicing, while disputed ones create a service ticket and alert the support team.\n\nSetup steps\n\n1Ô∏è‚É£ Connect all API integrations ‚Äî Webhook, AI Vision, AI Signature, ERP, Billing, and Notification systems.\n2Ô∏è‚É£ Configure your validation rules for delivery ID, signature, and photo.\n3Ô∏è‚É£ Set routing logic: verified ‚Üí invoice; disputed ‚Üí ticket.\n4Ô∏è‚É£ Map output fields for success and dispute responses.\n5Ô∏è‚É£ Test with sample deliveries before activating automation."
      },
      "typeVersion": 1
    },
    {
      "id": "007edb56-e515-45cd-a0c8-276a08637676",
      "name": "Sticky Note20",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -960,
        2064
      ],
      "parameters": {
        "color": 2,
        "width": 464,
        "height": 416,
        "content": "## ‚úÖ Completion & Outputs\n\nSummary\n\nAfter execution, the workflow updates the ERP and billing systems, sends the response to the original webhook, and alerts the relevant team if disputes arise.\n\nResults include:\n\nüßæ Invoice or ticket reference ID\n\nüì¨ Delivery verification status\n\n‚è±Ô∏è Processing time and timestamps\n\nüìß Notifications sent to ops and support teams"
      },
      "typeVersion": 1
    },
    {
      "id": "79a29a0c-1579-46ca-b3f6-733e4f76f16f",
      "name": "Sticky Note13",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2688,
        2048
      ],
      "parameters": {
        "color": 5,
        "width": 220,
        "height": 380,
        "content": "‚úçÔ∏è Signature Auth Check\n\n‚Ä¢ What: Analyzes handwriting for completeness and forgery patterns (e.g., via ML model).\n‚Ä¢ Why: Ensures genuine customer sign-off‚Äîcuts dispute escalations by validating 95% auto.\n‚Ä¢ Flows to: Merge analysis; rejects if incomplete."
      },
      "typeVersion": 1
    },
    {
      "id": "ff98e134-c444-4d99-bcd9-907db40404ff",
      "name": "Sticky Note12",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2688,
        1504
      ],
      "parameters": {
        "color": 5,
        "width": 208,
        "height": 412,
        "content": "üëÅÔ∏è AI Package Inspector\n\n‚Ä¢ What: Runs computer vision on photos to detect damage, tampering, or label mismatches.\n‚Ä¢ Why: Automates visual audits (humans miss 20%)‚Äîscales to 1000s of deliveries/day.\n‚Ä¢ Flows to: Merge with signature results; scores integrity 0-100."
      },
      "typeVersion": 1
    },
    {
      "id": "5c36ec9f-c0dd-4963-a7fe-b883f5d28855",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3088,
        2064
      ],
      "parameters": {
        "color": 3,
        "width": 310,
        "height": 416,
        "content": "‚öôÔ∏è Basic Data Scrub\n\n‚Ä¢ What: Checks for required fields (e.g., photo URL, GPS validity, signature blob).\n‚Ä¢ Why: Blocks junk data early‚Äîprevents crashes downstream, saving 30% debug time.\n‚Ä¢ Flows to: GPS/signature checks; branches to error if invalid."
      },
      "typeVersion": 1
    },
    {
      "id": "ae4617b0-a828-4783-943a-895a9144a59f",
      "name": "Sticky Note21",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2400,
        1920
      ],
      "parameters": {
        "color": 2,
        "width": 176,
        "height": 460,
        "content": "üîó Combine Insights\n\n‚Ä¢ What: Fuses AI vision + sig scores into single verification verdict (pass/fail).\n‚Ä¢ Why: Holistic view prevents siloed errors‚Äîone truth for routing decisions.\n‚Ä¢ Flows to: Status check; includes raw data for audits."
      },
      "typeVersion": 1
    },
    {
      "id": "ab67c262-716f-4b50-86d0-f7ea21370806",
      "name": "Sticky Note22",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1568,
        1648
      ],
      "parameters": {
        "color": 2,
        "width": 300,
        "height": 540,
        "content": "üí∞ Invoice Kickoff\n\n‚Ä¢ What: Generates customer invoice PDF from verified POD data.\n‚Ä¢ Why: Auto-bills on proof‚Äîspeeds cash flow, reduces DSO from weeks to days.\n‚Ä¢ Flows to: Mark as billable; attaches photo evidence."
      },
      "typeVersion": 1
    }
  ],
  "active": false,
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "81466bdc-b086-4117-bae5-9fe701b4df3f",
  "connections": {
    "Notify Dispute Team1": {
      "main": [
        [
          {
            "node": "Dispute Response1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate Input Data1": {
      "main": [
        [
          {
            "node": "AI Photo Verification1",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Signature Verification1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Return Error1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Photo Verification1": {
      "main": [
        [
          {
            "node": "Merge Analysis Results1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Dispute Ticket1": {
      "main": [
        [
          {
            "node": "Notify Dispute Team1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Analysis Results1": {
      "main": [
        [
          {
            "node": "Check Verification Status1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Delivery Status1": {
      "main": [
        [
          {
            "node": "Trigger Invoice Generation1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook - POD Submission1": {
      "main": [
        [
          {
            "node": "Validate Input Data1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Signature Verification1": {
      "main": [
        [
          {
            "node": "Merge Analysis Results1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Verification Status1": {
      "main": [
        [
          {
            "node": "Update Delivery Status1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create Dispute Ticket1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Trigger Invoice Generation1": {
      "main": [
        [
          {
            "node": "Success Response1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}